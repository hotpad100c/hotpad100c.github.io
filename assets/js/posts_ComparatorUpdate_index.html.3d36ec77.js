"use strict";(self.webpackChunkryan100c_vuepress_blog=self.webpackChunkryan100c_vuepress_blog||[]).push([[338],{5681(s,i,a){a.r(i),a.d(i,{comp:()=>t,data:()=>l});var h=a(9195);const n={},t=(0,a(2623).A)(n,[["render",function(s,i){return(0,h.uX)(),(0,h.CE)("div",null,[...i[0]||(i[0]=[(0,h.Fv)('<blockquote><p>当比较器被 <strong>NC 更新</strong> 或 <strong>比较器更新</strong> 触发时，它会“意识到”自己该改变了。</p></blockquote><p>这是 Minecraft 中文维基在介绍 <a href="https://zh.minecraft.wiki/w/Tutorial:%E6%AF%94%E8%BE%83%E5%99%A8%E6%9B%B4%E6%96%B0%E6%84%9F%E5%BA%94%E5%99%A8" target="_blank" rel="noopener noreferrer">CUD</a> 原理时的一段描述。 在不少教程中，“比较器更新”常常被与 NC 更新、PP 更新<strong>分开讲解</strong>。 这样做的初衷，是为了让“比较器更新”这个概念更容易被理解。 但同时，它也让许多人误以为——<strong>比较器更新</strong>是与 NC、PP 并列、相互独立的一种更新类型。</p><p>你是不是也这样认为呢？</p><p>如果你仔细阅读过 Minecraft 中文维基关于<a href="https://zh.minecraft.wiki/w/%E6%AF%94%E8%BE%83%E5%99%A8%E6%9B%B4%E6%96%B0" target="_blank" rel="noopener noreferrer">方块更新</a>的条目，就会注意到其中这样一段话：</p><blockquote><p><strong>比较器更新</strong> —— 方块结束 NC 更新后，会向水平方向或红石导体后方的红石比较器传播 NC 更新。</p></blockquote><p>看到了吗？ 比较器更新其实<strong>也是一种 NC 更新</strong>。 那么，它与普通的 NC 更新究竟有何不同？ “比较器更新”到底是什么呢？</p><hr><h1 id="所以-它是什么" tabindex="-1"><a class="header-anchor" href="#所以-它是什么"><span>所以，它是什么？</span></a></h1><p>仔细寻找后，我们可以发现， 实现比较器更新的方法在 Yarn 映射中叫 <code>world.updateComparators</code>， 而在 Mojang 映射中则叫 <code>level.updateNeighbourForOutputSignal</code>：</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark has-focused-lines vp-code"><code class="language-java"><span class="line has-focus"><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">public</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> void</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> updateNeighbourForOutputSignal</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;">final</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> BlockPos pos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#AB5959;--shiki-dark:#CB7676;"> final</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> Block changedBlock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>\n<span class="line has-focus"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">    for</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">Direction</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> direction</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> :</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> Direction</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Plane</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">HORIZONTAL</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">)</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">        BlockPos</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> relativePos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> pos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">relative</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">direction</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>\n<span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">        if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">hasChunkAt</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">relativePos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>\n<span class="line has-focus"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">            BlockState</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> =</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getBlockState</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">relativePos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>\n<span class="line has-focus"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">            if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">is</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Blocks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">COMPARATOR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>\n<span class="line has-focus"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">                this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">neighborChanged</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> relativePos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> changedBlock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> null</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>\n<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            }</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> else</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">isRedstoneConductor</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> relativePos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>\n<span class="line has-focus"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                relativePos </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;"> relativePos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">relative</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">direction</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>\n<span class="line"><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">                state </span><span style="--shiki-light:#999999;--shiki-dark:#666666;">=</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">getBlockState</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">relativePos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>\n<span class="line has-focus"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">                if</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> (</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">is</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">Blocks</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">COMPARATOR</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">))</span><span style="--shiki-light:#999999;--shiki-dark:#666666;"> {</span></span>\n<span class="line has-focus"><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;">                    this</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">.</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">neighborChanged</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">(</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;">state</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> relativePos</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#393A34;--shiki-dark:#DBD7CAEE;"> changedBlock</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> null</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">,</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> false</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">);</span></span>\n<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">                }</span></span>\n<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">            }</span></span>\n<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        }</span></span>\n<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    }</span></span>\n<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>我们来分析这段代码：</p><ul><li><code>for (Direction direction : Direction.Plane.HORIZONTAL)</code> 表示只遍历水平四个方向（东南西北），与垂直方向无关。 这很好理解，毕竟比较器的输入输出都是水平的。</li><li><code>BlockPos relativePos = pos.relative(direction);</code> 对于每个方向，以触发更新的方块位置<code>pos</code> 为基准，取得该方向上的直接邻格位置。</li><li><code>if (this.hasChunkAt(relativePos))</code> 检查该邻格所在区块是否已加载。</li><li><code>BlockState state = this.getBlockState(relativePos);</code> 读取邻格方块状态，用于判断它是否是比较器或红石导体。</li><li><code>if (state.is(Blocks.COMPARATOR)) { ... }</code> 如果邻格本身就是比较器，则直接调用<code>neighborChanged</code>（即常规的 NC 更新方法）。</li><li><code>else if (state.isRedstoneConductor(this, relativePos)) { ... }</code> 否则，如果该邻格是红石导体（其实指​<strong>实心方块</strong>​，Mojang 的命名在这里略显误导）： 向相同方向再前进一格 <strong><code>relativePos = relativePos.relative(direction);</code>， 再次检查那一格是否是比较器，如果是，同样调用</strong> <code>neighborChanged</code> 去触发更新。</li></ul><hr><p>现在，我们对“比较器更新”的定义就一目了然了： 它并不是<strong>​一种特殊的 NC 更新传播规则</strong>​。</p><p>可以这样总结：</p><blockquote><p><strong>比较器更新</strong> 是一种向某个方块相邻，或相邻的实心方块后方的比较器发送 NC 更新的特殊更新机制。</p></blockquote>',16)])])}]]),l=JSON.parse('{"path":"/posts/ComparatorUpdate/","title":"关于比较器更新","lang":"zh-CN","frontmatter":{"title":"关于比较器更新","date":"2025-11-6","permalink":"/posts/ComparatorUpdate/","tags":["Redstone"],"createTime":"2026/02/07 03:26:36"},"readingTime":{"minutes":2.54,"words":761},"git":{"createdTime":1762417415000,"updatedTime":1762728334000,"contributors":[{"name":"hotpad100c","username":"hotpad100c","email":"46704388+hotpad100c@users.noreply.github.com","commits":5,"avatar":"https://avatars.githubusercontent.com/hotpad100c?v=4","url":"https://github.com/hotpad100c"}]},"filePathRelative":"posts/关于比较器更新.md","headers":[],"categoryList":[]}')}}]);